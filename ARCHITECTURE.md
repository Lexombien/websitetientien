# üèóÔ∏è Ki·∫øn Tr√∫c ·ª®ng D·ª•ng

## üìä T·ªïng Quan

·ª®ng d·ª•ng **Floral Shop** l√† m·ªôt **Full-Stack Web Application** v·ªõi ki·∫øn tr√∫c:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   CLIENT                        ‚îÇ
‚îÇ  React 19 + Vite (Frontend - Port 5173)        ‚îÇ
‚îÇ  - Admin Panel                                  ‚îÇ
‚îÇ  - Product Management                           ‚îÇ
‚îÇ  - Media Library                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ HTTP/API Calls
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   SERVER                        ‚îÇ
‚îÇ  Express.js (Backend - Port 3001)              ‚îÇ
‚îÇ  - REST API                                     ‚îÇ
‚îÇ  - File Upload (Multer)                         ‚îÇ
‚îÇ  - Database (JSON)                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  STORAGE                        ‚îÇ
‚îÇ  - database.json (Products, Categories, etc)   ‚îÇ
‚îÇ  - uploads/ (Images)                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üé® Frontend (React + Vite)

### Tech Stack
- **React 19** - UI Library
- **Vite** - Build Tool & Dev Server
- **TypeScript** - Type Safety
- **CSS Modules** - Styling

### C·∫•u Tr√∫c Th∆∞ M·ª•c
```
‚îú‚îÄ‚îÄ App.tsx                 # Main App Component
‚îú‚îÄ‚îÄ components/             # React Components
‚îÇ   ‚îú‚îÄ‚îÄ AdminPanel.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ProductCard.tsx
‚îÇ   ‚îú‚îÄ‚îÄ MediaLibrary.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ hooks/                  # Custom Hooks
‚îú‚îÄ‚îÄ utils/                  # Utility Functions
‚îú‚îÄ‚îÄ types.ts                # TypeScript Types
‚îú‚îÄ‚îÄ constants.ts            # Constants
‚îî‚îÄ‚îÄ index.css              # Global Styles
```

### Features
- ‚úÖ Product Management (CRUD)
- ‚úÖ Category Management
- ‚úÖ Media Library v·ªõi SEO (Alt, Title, Description)
- ‚úÖ Image Upload & Delete
- ‚úÖ Admin Panel
- ‚úÖ Responsive Design
- ‚úÖ AI Integration (Gemini)

---

## ‚öôÔ∏è Backend (Express.js)

### Tech Stack
- **Express 5** - Web Framework
- **Multer** - File Upload
- **CORS** - Cross-Origin Resource Sharing
- **Node.js 22 LTS** - Runtime

### API Endpoints

#### Database API
```
GET  /api/database          # L·∫•y to√†n b·ªô database
POST /api/database          # L∆∞u database
GET  /api/ping              # Health check
```

#### Upload API
```
POST   /api/upload          # Upload single image
POST   /api/upload-multiple # Upload multiple images (max 5)
DELETE /api/upload/:filename # Delete image
GET    /api/uploads         # List all images
```

#### Static Files
```
GET /uploads/:filename      # Serve uploaded images
```

### Database Schema (JSON)

```json
{
  "products": [
    {
      "id": "string",
      "name": "string",
      "price": "number",
      "description": "string",
      "category": "string",
      "images": ["url1", "url2"],
      "featured": "boolean"
    }
  ],
  "categories": [
    {
      "id": "string",
      "name": "string",
      "description": "string"
    }
  ],
  "settings": {
    "siteName": "string",
    "logo": "string",
    "customCSS": "string"
  },
  "categorySettings": {},
  "media": {
    "filename": {
      "alt": "string",
      "title": "string",
      "description": "string"
    }
  },
  "zaloNumber": "string"
}
```

---

## üöÄ Development Workflow

### Local Development

1. **Start Backend:**
   ```bash
   npm run server
   # Backend ch·∫°y tr√™n http://localhost:3001
   ```

2. **Start Frontend:**
   ```bash
   npm run dev
   # Frontend ch·∫°y tr√™n http://localhost:5173
   ```

3. **Ho·∫∑c ch·∫°y c√πng l√∫c:**
   ```bash
   npm run dev:all
   # Ch·∫°y c·∫£ backend v√† frontend
   ```

### Production Build

```bash
npm run build
# Output: dist/ folder
```

---

## üåê Production Deployment (VPS)

### Ki·∫øn Tr√∫c Production

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   NGINX                         ‚îÇ
‚îÇ  Reverse Proxy (Port 80)                       ‚îÇ
‚îÇ  - Serve static files (dist/)                  ‚îÇ
‚îÇ  - Proxy /api/* to backend                     ‚îÇ
‚îÇ  - Serve /uploads/*                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PM2                          ‚îÇ
‚îÇ  Process Manager                                ‚îÇ
‚îÇ  - Auto restart on crash                       ‚îÇ
‚îÇ  - Log management                              ‚îÇ
‚îÇ  - Cluster mode support                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Express Backend                    ‚îÇ
‚îÇ  Running on localhost:3001                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Nginx Configuration

```nginx
server {
    listen 80;
    server_name _;

    # Frontend (static files)
    location / {
        root /var/www/floral-shop/dist;
        try_files $uri $uri/ /index.html;
    }

    # Backend API
    location /api/ {
        proxy_pass http://localhost:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Uploads
    location /uploads/ {
        alias /var/www/floral-shop/uploads/;
    }
}
```

### PM2 Configuration

```javascript
// ecosystem.config.cjs (CommonJS v√¨ package.json d√πng "type": "module")
module.exports = {
  apps: [{
    name: 'floral-backend',
    script: './server.js',
    instances: 1,
    env: {
      NODE_ENV: 'production',
      PORT: 3001
    }
  }]
}
```

**Note:** File ph·∫£i l√† `.cjs` (CommonJS) v√¨ `package.json` c√≥ `"type": "module"`.

---

## üìÅ File Structure

```
floral-shop/
‚îú‚îÄ‚îÄ üìÑ Frontend Files
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx
‚îÇ   ‚îú‚îÄ‚îÄ index.tsx
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ
‚îú‚îÄ‚îÄ ‚öôÔ∏è Backend Files
‚îÇ   ‚îú‚îÄ‚îÄ server.js
‚îÇ   ‚îî‚îÄ‚îÄ ecosystem.config.cjs (generated)
‚îÇ
‚îú‚îÄ‚îÄ üíæ Data & Storage
‚îÇ   ‚îú‚îÄ‚îÄ database.json
‚îÇ   ‚îú‚îÄ‚îÄ uploads/
‚îÇ   ‚îî‚îÄ‚îÄ backups/
‚îÇ
‚îú‚îÄ‚îÄ üõ†Ô∏è Config Files
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ vite.config.ts
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îú‚îÄ‚îÄ .env.local
‚îÇ   ‚îî‚îÄ‚îÄ .env.example
‚îÇ
‚îú‚îÄ‚îÄ üöÄ Deploy Scripts
‚îÇ   ‚îú‚îÄ‚îÄ setup-vps.sh
‚îÇ   ‚îú‚îÄ‚îÄ deploy.sh
‚îÇ   ‚îî‚îÄ‚îÄ update.sh
‚îÇ
‚îî‚îÄ‚îÄ üìñ Documentation
    ‚îú‚îÄ‚îÄ README.md
    ‚îú‚îÄ‚îÄ QUICKSTART_DEPLOY.md
    ‚îú‚îÄ‚îÄ DEPLOY_VPS_GUIDE.md
    ‚îî‚îÄ‚îÄ ARCHITECTURE.md (this file)
```

---

## üîí Security

### Backend Security
- ‚úÖ CORS enabled
- ‚úÖ File type validation (images only)
- ‚úÖ File size limit (5MB)
- ‚úÖ Path traversal protection
- ‚úÖ Sanitized filenames

### Frontend Security
- ‚úÖ XSS protection
- ‚úÖ CSRF protection (via SameSite cookies)
- ‚úÖ Input validation
- ‚úÖ Secure headers (via Nginx)

---

## üìä Performance

### Frontend Optimization
- ‚úÖ Code splitting (Vite)
- ‚úÖ Lazy loading
- ‚úÖ Image optimization
- ‚úÖ CSS minification
- ‚úÖ Tree shaking

### Backend Optimization
- ‚úÖ Static file caching (1 year)
- ‚úÖ Gzip compression (Nginx)
- ‚úÖ ETags for cache validation
- ‚úÖ PM2 cluster mode support

---

## üîÑ Data Flow

### Upload Image Flow

```
1. User selects image in Admin Panel
   ‚Üì
2. Frontend sends POST to /api/upload
   ‚Üì
3. Multer processes file
   ‚Üì
4. File saved to uploads/
   ‚Üì
5. Backend returns image URL
   ‚Üì
6. Frontend updates UI with new image
```

### Save Product Flow

```
1. User fills product form
   ‚Üì
2. Frontend validates data
   ‚Üì
3. Frontend sends POST to /api/database
   ‚Üì
4. Backend saves to database.json
   ‚Üì
5. Backend returns success
   ‚Üì
6. Frontend updates product list
```

---

## üß™ Testing

### Manual Testing Checklist

- [ ] Upload image
- [ ] Delete image
- [ ] Create product
- [ ] Edit product
- [ ] Delete product
- [ ] Create category
- [ ] Edit category
- [ ] Delete category
- [ ] Update settings
- [ ] Custom CSS works

---

## üìà Scalability

### Current Limitations
- JSON database (not suitable for >1000 products)
- Single server (no load balancing)
- File storage on server (no CDN)

### Future Improvements
- Migrate to PostgreSQL/MongoDB
- Add Redis for caching
- Use S3/CloudFlare for image storage
- Implement load balancing
- Add search functionality (Elasticsearch)

---

## üõ†Ô∏è Tech Stack Summary

| Layer | Technology |
|-------|-----------|
| **Frontend** | React 19, Vite, TypeScript |
| **Backend** | Express 5, Node.js 22 |
| **Database** | JSON (file-based) |
| **File Upload** | Multer |
| **Process Manager** | PM2 |
| **Web Server** | Nginx |
| **AI** | Google Gemini API |

---

## üìû Support

N·∫øu c·∫ßn h·ªó tr·ª£, ki·ªÉm tra:
- Logs backend: `pm2 logs floral-backend`
- Logs Nginx: `sudo tail -f /var/log/nginx/error.log`
- Database: `cat database.json | jq`

---

**Last Updated:** 2026-01-03
